!function(a){var b=new Array,c=new Array,d=!1;a.fn.doAutosize=function(b){var c=a(this).data("minwidth"),d=a(this).data("maxwidth"),e="",f=a(this),g=a("#"+a(this).data("tester_id"));if(e!==(e=f.val())){var h=e.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");g.html(h);var i=g.width(),j=i+b.comfortZone>=c?i+b.comfortZone:c,k=f.width(),l=k>j&&j>=c||j>c&&d>j;l&&f.width(j)}},a.fn.resetAutosize=function(b){var c=a(this).data("minwidth")||b.minInputWidth||a(this).width(),d=a(this).data("maxwidth")||b.maxInputWidth||a(this).closest(".tagsinput").width()-b.inputPadding,e=a(this),f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),g=a(this).attr("id")+"_autosize_tester";!a("#"+g).length>0&&(f.attr("id",g),f.appendTo("body")),e.data("minwidth",c),e.data("maxwidth",d),e.data("tester_id",g),e.css("width",c)},a.fn.addTag=function(e,f){return f=jQuery.extend({focus:!1,callback:!0},f),this.each(function(){var g=a(this).attr("id"),h=a(this).val().split(b[g]);""==h[0]&&(h=new Array),e=jQuery.trim(e);var i=!1;if(f.unique)var i=a(this).tagExist(e);if(!i&&d&&!f.autocompleted)var i=!0;if(1==i&&a("#"+g+"_tag").addClass("not_valid"),""!=e&&1!=i){if(a("<span>").addClass("tag").append(a("<span>").text(e).append("&nbsp;&nbsp;"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+g).removeTag(escape(e))})).insertBefore("#"+g+"_addTag"),h.push(e),a("#"+g+"_tag").val(""),f.focus?a("#"+g+"_tag").focus():a("#"+g+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,h),f.callback&&c[g]&&c[g].onAddTag){var j=c[g].onAddTag;j.call(this,e)}if(c[g]&&c[g].onChange){var k=h.length,j=c[g].onChange;j.call(this,a(this),h[k-1])}}}),!1},a.fn.removeTag=function(d){return d=unescape(d),this.each(function(){var e=a(this).attr("id"),f=a(this).val().split(b[e]);for(a("#"+e+"_tagsinput .tag").remove(),str="",i=0;i<f.length;i++)f[i]!=d&&(str=str+b[e]+f[i]);if(a.fn.tagsInput.importTags(this,str),c[e]&&c[e].onRemoveTag){var g=c[e].onRemoveTag;g.call(this,d)}}),!1},a.fn.tagExist=function(c){var d=a(this).attr("id"),e=a(this).val().split(b[d]);return jQuery.inArray(c,e)>=0},a.fn.importTags=function(b){var c=a(this).attr("id");a("#"+c+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)},a.fn.tagsInput=function(f){var g=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},f),h=0;return this.each(function(){if("undefined"==typeof a(this).attr("data-tagsinput-init")){a(this).attr("data-tagsinput-init",!0),g.hide&&a(this).hide();var f=a(this).attr("id");(!f||b[a(this).attr("id")])&&(f=a(this).attr("id","tags"+(new Date).getTime()+h++).attr("id"));var i=jQuery.extend({pid:f,real_input:"#"+f,holder:"#"+f+"_tagsinput",input_wrapper:"#"+f+"_addTag",fake_input:"#"+f+"_tag"},g);b[f]=i.delimiter,(g.onAddTag||g.onRemoveTag||g.onChange)&&(c[f]=new Array,c[f].onAddTag=g.onAddTag,c[f].onRemoveTag=g.onRemoveTag,c[f].onChange=g.onChange);var j='<div id="'+f+'_tagsinput" class="tagsinput"><div id="'+f+'_addTag">';if(g.interactive&&(j=j+'<input id="'+f+'_tag" value="" data-default="'+g.defaultText+'" />'),j+='</div><div class="tags_clear"></div></div>',a(j).insertAfter(this),a(i.holder).css("width",g.width),a(i.holder).css("min-height",g.height),a(i.holder).css("height",g.height),d=i.autocomplete_only,""!=a(i.real_input).val()&&a.fn.tagsInput.importTags(a(i.real_input),a(i.real_input).val()),g.interactive){if(a(i.fake_input).val(a(i.fake_input).attr("data-default")),a(i.fake_input).css("color",g.placeholderColor),a(i.fake_input).resetAutosize(g),a(i.holder).bind("click",i,function(b){a(b.data.fake_input).focus()}),a(i.fake_input).bind("focus",i,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&a(b.data.fake_input).val(""),a(b.data.fake_input).css("color","#000000")}),void 0!=g.autocomplete_url){autocomplete_options={source:g.autocomplete_url};for(attrname in g.autocomplete)autocomplete_options[attrname]=g.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(i.fake_input).autocomplete(g.autocomplete_url,g.autocomplete),a(i.fake_input).bind("result",i,function(b,c,d){c&&a("#"+f).addTag(c[0]+"",{focus:!0,unique:g.unique,autocompleted:!0})})):void 0!==jQuery.ui.autocomplete&&(a(i.fake_input).autocomplete(autocomplete_options),a(i.fake_input).bind("autocompleteselect",i,function(b,c){return a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:g.unique,autocompleted:!0}),!1}))}else a(i.fake_input).bind("blur",i,function(b){var c=a(this).attr("data-default");return""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=c?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:g.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",g.placeholderColor)),!1});a(i.fake_input).bind("keypress",i,function(b){return e(b)?(b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:g.unique}),a(b.data.fake_input).resetAutosize(g),!1):void(b.data.autosize&&a(b.data.fake_input).doAutosize(g))}),i.removeWithBackspace&&a(i.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();var c=a(this).closest(".tagsinput").find(".tag:last").text(),d=a(this).attr("id").replace(/_tag$/,"");c=c.replace(/[\s]+x$/,""),a("#"+d).removeTag(escape(c)),a(this).trigger("focus")}}),a(i.fake_input).blur(),i.unique&&a(i.fake_input).keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&a(this).removeClass("not_valid")})}}}),this},a.fn.tagsInput.updateTagsField=function(c,d){var e=a(c).attr("id");a(c).val(d.join(b[e]))},a.fn.tagsInput.importTags=function(d,e){a(d).val("");var f=a(d).attr("id"),g=e.split(b[f]);for(i=0;i<g.length;i++)a(d).addTag(g[i],{focus:!1,callback:!1});if(c[f]&&c[f].onChange){var h=c[f].onChange;h.call(d,d,g[i])}};var e=function(b){var c=!1;return 13==b.which?!0:("string"==typeof b.data.delimiter?b.which==b.data.delimiter.charCodeAt(0)&&(c=!0):a.each(b.data.delimiter,function(a,d){b.which==d.charCodeAt(0)&&(c=!0)}),c)}}(jQuery);